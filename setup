#!/bin/bash

if [ "$EUID" -ne 0 ]; then
  echo Ejecuta como root (sudo).
  exit
fi

USO = "Uso: \#$0 router|server1|server2"

if[$#<1]; then
	echo $USO
	exit
fi

read -p "Desactiva el gestor automÃ¡tico de la red. Activar red NO marcado. Pulsa enter para continuar."
echo "$Deity quiera que lo hayas hecho de verdad..."

function router {
	apt-get install vlan
	modprobe 8021q
	su -c 'echo "8021q" >> /etc/modules'

	
	cp ./router_3_interfaces /etc/network/interfaces

	ifdown eth0
	ifup eth0
	ifup eth1.31
	ifup eth1.32


	sysctl -w net.ipv4.ip_forward=1
	#O hacerlo permanente descomentando la linea en /etc/sysctl

	iptables -t nat -A POSTROUTING ! -d 192.168.0.0/16 -o eth0 -j MASQUERADE
	iptables-save
	apt-get install iptables-persistent
}


function server1 {
	cp ./server_31_interfaces /etc/network/interfaces
	ifdown eth0
	ifup eth0
}

function server2 {
	cp ./server_32_interfaces /etc/network/interfaces
	ifdown eth0
	ifup eth0
}


if[$1 = "router"]; then
	router
elif [$1 = "server1"]; then
	server1
elif [$1 = "server2"]; then
	server2
else
	echo $USO
	exit
fi





